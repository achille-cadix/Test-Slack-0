<h2>Notificateur VZéro</h2>
<h4>Indiquez la maquette updatée</h4>
<ul id="results">
</ul>

<script>
  "use strict";
  let choices = [];
  let userName = "";

  onmessage = event => {
    if (event.data.pluginMessage.type === "choices") {
      choices = event.data.pluginMessage.choices;
      userName = event.data.pluginMessage.userName;
      updateUi()
    }
  }

  function updateUi() {
    let choiceButtons = []; 
    choices?.forEach(value => {
      console.log(value.characters);
      choiceButtons.push(
        `<li>
          <button onclick="selectChoice('${value.characters}')">${value.characters}</button>
        </li>`
        )
    })
    document.getElementById('results').innerHTML = choiceButtons;
  }

  function selectChoice(title) {
    const slackUrl = 'https://hooks.slack.com/workflows/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';
    parent.postMessage({
      pluginMessage: { action: "select", value: title}
    });
    const body = {
      title,
      userName
    }
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open("POST", slackUrl, false );
    xmlHttp.send(JSON.stringify(body));
    console.log(xmlHttp.responseText);
  }

</script>
